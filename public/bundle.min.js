"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},app=angular.module("app",["ui.router","angular-cache","ngMaterial","angularMoment"]);app.constant("HTTP_RESPONSES",{NoResponse:-1,OK:200,Created:201,MovedPermanently:301,BadRequest:400,Forbidden:403,NotFound:404,MethodNotAllowed:405,UnsupportedMediaType:415,TooManyRequests:429,InternalServerError:500,NotImplemented:501,ServiceUnavailable:503}),app.constant("USER_ROLES",{User:1,UserManager:2,Admin:3}),app.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",signupSuccess:"auth-signup-success",signupFailed:"auth-signup-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","USER_ROLES","$compileProvider","$mdDateLocaleProvider","$mdThemingProvider","moment","$httpProvider",function(e,t,o,n,r,a,s,u,i){function c(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;for(var t in e)if(e.hasOwnProperty(t)){var o=e[t];"string"!=typeof o||"[object Date]"!==Object.prototype.toString.call(new Date(o))||isNaN(new Date(o).getTime())?"object"===("undefined"==typeof o?"undefined":_typeof(o))&&c(o):e[t]=new Date(o)}}function d(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;for(var t in e)if(e.hasOwnProperty(t)){var o=e[t];if("string"==typeof o)try{o=JSON.parse(o)}catch(e){}else"object"===("undefined"==typeof o?"undefined":_typeof(o))&&d(o)}}i.defaults.transformResponse.push(function(e){return c(e),d(e),e}),r.preAssignBindingsEnabled(!0),a.formatDate=function(e){return e?u(e).format("DD/MM/YYYY"):""},a.parseDate=function(e){var t=u(e,"DD/MM/YYYY",!0);return t.isValid()?t.toDate():new Date(NaN)},s.definePalette("customPalette",{50:"e4e7ea",100:"c0c6cd",200:"9aa4af",300:"707f8e",400:"526476",500:"34495e",600:"2f4255",700:"2a3b4c",800:"243342",900:"1b2631",A100:"C5CAE9",A200:"9FA8DA",A400:"7986CB",A700:"5C6BC0",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0});var l=s.extendPalette("green",{500:"#2ecc71",contrastDefaultColor:"light"});s.definePalette("customAccent",l),s.theme("default").primaryPalette("customPalette").accentPalette("customAccent",{default:"500"}),o.html5Mode(!0),t.otherwise("/jogs"),t.rule(function(e,t){var o=t.path(),n="/"===o[o.length-1];if(n){var r=o.substr(0,o.length-1);return r}}),e.state("auth",{abstract:!0,templateUrl:"/app/pages/auth/auth.view.html",controller:"authController"}).state("auth.login",{url:"/login"}).state("auth.signup",{url:"/signup"}).state("home",{abstract:!0,templateUrl:"/app/pages/home/home.view.html",controller:"homeController"}).state("home.jogs",{url:"/jogs",templateUrl:"/app/pages/home/jogs/jogs.view.html",controller:"jogsController",data:{authorizedRoles:[n.User,n.UserManager,n.Admin]}}).state("home.reports",{url:"/reports",data:{authorizedRoles:[n.User,n.UserManager,n.Admin]}}).state("home.manage-users",{url:"/manage-users",templateUrl:"/app/pages/home/manage-users/manage-users.view.html",controller:"manageUsersController",data:{authorizedRoles:[n.UserManager,n.Admin]}})}]),app.run(["$rootScope","$state","AuthFactory","AUTH_EVENTS",function(e,t,o,n){e.$on("$stateChangeStart",function(t,r){r.data&&r.data.authorizedRoles&&(o.isAuthorized(r.data.authorizedRoles)||(t.preventDefault(),o.isAuthenticated()?e.$broadcast(n.notAuthorized):e.$broadcast(n.notAuthenticated)))}),e.$on(n.notAuthenticated,function(){t.go("auth.login")}),e.$on(n.logoutSuccess,function(){t.go("auth.login")})}]),app.controller("rootController",["$scope","$state",function(e,t){e.app_test="APP WORKING"}]),angular.module("app").constant("API_URL","https://project-jogging-tracker.herokuapp.com/api");var app=angular.module("app");app.factory("ApiFactory",["$http","CacheFactory","API_URL","HTTP_RESPONSES",function(e,t,o,n){function r(e,t){var o=[];for(var n in e)o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return o.join("&")}var a={};return a.request=function(a,s,u){return new Promise(function(i,c){if(["POST","GET","PUT","DELETE"].indexOf(a)===-1)throw new Error("received unsupported HTTP method");if("string"!=typeof s)throw new Error("endpoint must be a string");"/"!==s[0]&&(s="/"+s);var d={method:a,url:o+s,headers:{}};if("POST"!==a&&"PUT"!==a||(d.headers["Content-Type"]="application/x-www-form-urlencoded",d.transformRequest=r),t.get("authCache")){var l=t.get("authCache"),p=l.get("user");p&&(l.info("user").isExpired||(d.headers.Authorization=p.token))}u&&("POST"!==a&&"PUT"!==a||(d.data=u),"GET"===a&&(d.params=u)),e(d).then(function(e){return i({status:e.status,payload:e.data.payload})},function(e){return c(e?{status:e.status,payload:e.data.payload}:{status:n.NoResponse,payload:null})})})},a}]);var app=angular.module("app");app.factory("AuthFactory",["$http","CacheFactory","ApiFactory","$rootScope","AUTH_EVENTS",function(e,t,o,n,r){var a={},s=void 0;return s=t.get("authCache")?t.get("authCache"):t("authCache",{storageMode:"localStorage",maxAge:432e5,deleteOnExpire:"aggressive",recycleFreq:6e4}),a.getUser=function(){var e=s.get("user");return e?s.info("user").isExpired?null:e.user:null},a.login=function(e){return new Promise(function(t,n){o.request("POST","/user/authenticate",e).then(function(e){return s.put("user",{token:e.payload.token,user:e.payload.user}),t()},n)})},a.logout=function(){s.remove("user"),n.$broadcast(r.logoutSuccess)},a.signup=function(e){var t=angular.copy(e);return t.name=JSON.stringify(e.name),new Promise(function(e,n){o.request("POST","/user",t).then(function(t){return s.put("user",{token:t.payload.token,user:t.payload.user}),e()},n)})},a.isAuthenticated=function(){return!!a.getUser()&&!!a.getUser()._id},a.isAuthorized=function(e){return angular.isArray(e)||(e=[e]),a.isAuthenticated()&&e.indexOf(a.getUser().role)!==-1},a}]);var app=angular.module("app");app.factory("JogFactory",["ApiFactory",function(e){var t={};return t.getJogs=function(t,o){return new Promise(function(n,r){var a="",s=void 0,u=void 0;t&&(s="fromDate="+t.toISOString()),o&&(u="toDate="+o.toISOString()),a=s&&u?"?"+s+"&"+u:"?"+(s||u),e.request("GET","/jog"+a).then(function(e){return n(e.payload)},r)})},t.createJog=function(t){return new Promise(function(o,n){e.request("POST","/jog",t).then(function(e){return o(e.payload)},n)})},t.updateJog=function(t){return new Promise(function(o,n){e.request("PUT","/jog/"+t._id,t).then(function(e){return o(e.payload)},n)})},t.deleteJog=function(t){return new Promise(function(o,n){e.request("DELETE","/jog/"+t).then(function(e){return o()},n)})},t}]);var app=angular.module("app");app.factory("UserFactory",["ApiFactory",function(e){var t={};return t.getUsers=function(){return new Promise(function(t,o){e.request("GET","/user").then(function(e){return t(e.payload)},o)})},t.updateUser=function(t){return t.name&&(t.name=JSON.stringify(t.name)),new Promise(function(o,n){e.request("PUT","/user/"+t._id,t).then(function(e){return o(e.payload)},n)})},t.deleteUser=function(t){return new Promise(function(o,n){e.request("DELETE","/user/"+t).then(function(e){return o()},n)})},t}]);var app=angular.module("app");app.controller("authController",["$scope","$rootScope","$state","AuthFactory","AUTH_EVENTS","HTTP_RESPONSES","$timeout",function(e,t,o,n,r,a,s){e.errorMessage="",e.getErrorMessage=function(){return e.errorMessage},e.credentials={name:{first:"",last:""},email:"",password:""},e.isLoginForm=function(){return"auth.login"===o.current.name},e.login=function(u){n.login(u).then(function(){t.$broadcast(r.loginSuccess),o.go("home.jogs")},function(o){t.$broadcast(r.loginFailed),s(function(){switch(o.status){case a.NotFound:e.errorMessage="Oops! That user doesn't exist.";break;case a.BadRequest:o.payload.InvalidArguments?(e.errorMessage="Some fields were invalid!",console.error("Invalid arguments:",o.payload.InvalidArguments)):"user already exists"===o.payload.message?e.errorMessage="An account already exists for that email.":e.errorMessage="Something went wrong. This is embarassing.";break;case a.Forbidden:e.errorMessage="Hmmm. Wrong password.";break;case a.InternalServerError:e.errorMessage="Something went wrong. This is embarassing."}})})},e.signup=function(u){n.signup(u).then(function(){t.$broadcast(r.signupSuccess),o.go("home.jogs")},function(o){t.$broadcast(r.signupFailed),s(function(){switch(o.status){case a.NotFound:e.errorMessage="Oops! That user doesn't exist.";break;case a.BadRequest:o.payload.InvalidArguments?(e.errorMessage="Some fields were invalid!",console.error("Invalid arguments:",o.payload.InvalidArguments)):"user already exists"===o.payload.message?e.errorMessage="An account already exists for that email.":e.errorMessage="Something went wrong. This is embarassing.";break;case a.Forbidden:e.errorMessage="Hmmm. Wrong password.";break;case a.InternalServerError:e.errorMessage="Something went wrong. This is embarassing."}})})}}]);var app=angular.module("app");app.controller("homeController",["$scope","$state","AuthFactory","USER_ROLES",function(e,t,o,n){e.navOpen=!0,e.isNavOpen=function(){return e.navOpen},e.toggleNavOpen=function(){e.navOpen=!e.navOpen},e.getState=function(){return t.current.name},e.getPageTitle=function(){switch(t.current.name){case"home.jogs":return"My Jogs";case"home.reports":return"Reports";case"home.manage-users":return"Manage Users";default:return""}},e.showMenuItem=function(e){var n=t.get(e);return o.isAuthorized(n.data.authorizedRoles)},e.getUser=function(){return o.getUser()},e.logout=function(){o.logout()}}]);var app=angular.module("app");app.controller("jogsController",["$scope","JogFactory","HTTP_RESPONSES","$timeout","$mdToast","AuthFactory",function(e,t,o,n,r,a){function s(e){r.show(r.simple().textContent(e).position("top right").action("ok").hideDelay(5e3))}var u=new Date;u.setDate(u.getDate()-7),e.date={from:u,to:new Date},e.jogs=[],e.getJogs=function(){return e.jogs},e.newJog={date:new Date,distance:0,time:0},e.computeAverageSpeed=function(e){var t=e.distance/(e.time/60);return isNaN(t)?"?":t.toFixed(2)},e.editingId="",e.editEntry=function(t,o){e.editingId=t+o},e.stopEditing=function(){e.editingId=""},e.createJog=function(n){t.createJog(n).then(function(){s("Woohoo! Your jog was added."),e.fetchJogs()},function(e){switch(e.status){case o.BadRequest:s(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case o.Forbidden:a.logout();break;case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.deleteJog=function(n){t.deleteJog(n._id).then(function(){s("Woohoo! Your jog was deleted."),e.fetchJogs()},function(e){switch(e.status){case o.Forbidden:a.logout();break;case o.NotFound:case o.BadRequest:case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.updateJog=function(n){t.updateJog(n).then(function(){s("Woohoo! Your jog was updated."),e.fetchJogs()},function(e){switch(e.status){case o.BadRequest:s(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case o.Forbidden:a.logout();break;case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.fetchJogs=function(){t.getJogs(e.date.from,e.date.to).then(function(t){n(function(){e.jogs=t||[]})},function(t){switch(t.status){case o.NotFound:n(function(){e.jogs=[]});break;case o.Forbidden:a.logout();break;case o.BadRequest:case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",t);break;default:console.error("Unknown status code in response:",t)}})},e.fetchJogs()}]);var app=angular.module("app");app.controller("manageUsersController",["$scope","UserFactory","HTTP_RESPONSES","$timeout","$mdToast","AuthFactory","USER_ROLES",function(e,t,o,n,r,a,s){function u(e){r.show(r.simple().textContent(e).position("top right").action("ok").hideDelay(5e3))}e.users=[],e.getUsers=function(){return e.users},e.USER_ROLES=s,e.getRoleName=function(e){for(var t in s)if(s.hasOwnProperty(t)&&s[t]===e)return t;return""},e.editingId="",e.editEntry=function(t,o){e.editingId=t+o},e.stopEditing=function(){e.editingId=""},e.deleteUser=function(n){t.deleteUser(n._id).then(function(){u("Woohoo! The user was deleted."),e.fetchUsers()},function(e){switch(e.status){case o.Forbidden:a.logout();break;case o.NotFound:case o.BadRequest:case o.InternalServerError:u("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.updateUser=function(n){t.updateUser(n).then(function(){u("Woohoo! The user was updated."),e.fetchUsers()},function(e){switch(e.status){case o.BadRequest:u(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case o.Forbidden:a.logout();break;case o.InternalServerError:u("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.fetchUsers=function(){t.getUsers().then(function(t){n(function(){e.users=t||[]})},function(t){switch(t.status){case o.NotFound:n(function(){e.users=[]});break;case o.Forbidden:a.logout();break;case o.BadRequest:case o.InternalServerError:u("Something went wrong there. This is embarassing."),console.error("Response:",t);break;default:console.error("Unknown status code in response:",t)}})},e.fetchUsers()}]);