"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},app=angular.module("app",["ui.router","angular-cache","ngMaterial","angularMoment","chart.js"]);app.constant("HTTP_RESPONSES",{NoResponse:-1,OK:200,Created:201,MovedPermanently:301,BadRequest:400,Forbidden:403,NotFound:404,MethodNotAllowed:405,UnsupportedMediaType:415,TooManyRequests:429,InternalServerError:500,NotImplemented:501,ServiceUnavailable:503}),app.constant("USER_ROLES",{User:1,UserManager:2,Admin:3}),app.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",signupSuccess:"auth-signup-success",signupFailed:"auth-signup-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","USER_ROLES","$compileProvider","$mdDateLocaleProvider","$mdThemingProvider","moment","$httpProvider","ChartJsProvider",function(e,t,r,o,n,a,s,i,u,c){function d(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];"string"!=typeof r||"[object Date]"!==Object.prototype.toString.call(new Date(r))||isNaN(new Date(r).getTime())?"object"===("undefined"==typeof r?"undefined":_typeof(r))&&d(r):e[t]=new Date(r)}}function l(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if("string"==typeof r)try{r=JSON.parse(r)}catch(e){}else"object"===("undefined"==typeof r?"undefined":_typeof(r))&&l(r)}}u.defaults.transformResponse.push(function(e){return d(e),l(e),e}),c.setOptions({chartColors:["#34495e","#707f8e"]}),n.preAssignBindingsEnabled(!0),a.formatDate=function(e){return e?i(e).format("DD/MM/YYYY"):""},a.parseDate=function(e){var t=i(e,"DD/MM/YYYY",!0);return t.isValid()?t.toDate():new Date(NaN)},s.definePalette("customPalette",{50:"e4e7ea",100:"c0c6cd",200:"9aa4af",300:"707f8e",400:"526476",500:"34495e",600:"2f4255",700:"2a3b4c",800:"243342",900:"1b2631",A100:"C5CAE9",A200:"9FA8DA",A400:"7986CB",A700:"5C6BC0",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0});var p=s.extendPalette("green",{500:"#2ecc71",contrastDefaultColor:"light"});s.definePalette("customAccent",p),s.theme("default").primaryPalette("customPalette").accentPalette("customAccent",{default:"500"}),r.html5Mode(!0),t.otherwise("/jogs"),t.rule(function(e,t){var r=t.path(),o="/"===r[r.length-1];if(o){var n=r.substr(0,r.length-1);return n}}),e.state("auth",{abstract:!0,templateUrl:"/app/pages/auth/auth.view.html",controller:"authController"}).state("auth.login",{url:"/login"}).state("auth.signup",{url:"/signup"}).state("home",{abstract:!0,templateUrl:"/app/pages/home/home.view.html",controller:"homeController"}).state("home.jogs",{url:"/jogs",templateUrl:"/app/pages/home/jogs/jogs.view.html",controller:"jogsController",data:{authorizedRoles:[o.User,o.UserManager,o.Admin]}}).state("home.reports",{url:"/reports",templateUrl:"/app/pages/home/reports/reports.view.html",controller:"reportsController",data:{authorizedRoles:[o.User,o.UserManager,o.Admin]}}).state("home.manage-users",{url:"/manage-users",templateUrl:"/app/pages/home/manage-users/manage-users.view.html",controller:"manageUsersController",data:{authorizedRoles:[o.UserManager,o.Admin]}})}]),app.run(["$rootScope","$state","AuthFactory","AUTH_EVENTS",function(e,t,r,o){e.$on("$stateChangeStart",function(t,n){n.data&&n.data.authorizedRoles&&(r.isAuthorized(n.data.authorizedRoles)||(t.preventDefault(),r.isAuthenticated()?e.$broadcast(o.notAuthorized):e.$broadcast(o.notAuthenticated)))}),e.$on(o.notAuthenticated,function(){t.go("auth.login")}),e.$on(o.logoutSuccess,function(){t.go("auth.login")})}]),app.controller("rootController",["$scope","$state",function(e,t){e.app_test="APP WORKING"}]),angular.module("app").constant("API_URL","https://project-jogging-tracker.herokuapp.com/api");var app=angular.module("app");app.factory("ApiFactory",["$http","CacheFactory","API_URL","HTTP_RESPONSES",function(e,t,r,o){function n(e,t){var r=[];for(var o in e)r.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return r.join("&")}var a={};return a.request=function(a,s,i){return new Promise(function(u,c){if(["POST","GET","PUT","DELETE"].indexOf(a)===-1)throw new Error("received unsupported HTTP method");if("string"!=typeof s)throw new Error("endpoint must be a string");"/"!==s[0]&&(s="/"+s);var d={method:a,url:r+s,headers:{}};if("POST"!==a&&"PUT"!==a||(d.headers["Content-Type"]="application/x-www-form-urlencoded",d.transformRequest=n),t.get("authCache")){var l=t.get("authCache"),p=l.get("user");p&&(l.info("user").isExpired||(d.headers.Authorization=p.token))}i&&("POST"!==a&&"PUT"!==a||(d.data=i),"GET"===a&&(d.params=i)),e(d).then(function(e){return u({status:e.status,payload:e.data.payload})},function(e){return c(e?{status:e.status,payload:e.data.payload}:{status:o.NoResponse,payload:null})})})},a}]);var app=angular.module("app");app.factory("AuthFactory",["$http","CacheFactory","ApiFactory","$rootScope","AUTH_EVENTS",function(e,t,r,o,n){var a={},s=void 0;return s=t.get("authCache")?t.get("authCache"):t("authCache",{storageMode:"localStorage",maxAge:432e5,deleteOnExpire:"aggressive",recycleFreq:6e4}),a.getUser=function(){var e=s.get("user");return e?s.info("user").isExpired?null:e.user:null},a.login=function(e){return new Promise(function(t,o){r.request("POST","/user/authenticate",e).then(function(e){return s.put("user",{token:e.payload.token,user:e.payload.user}),t()},o)})},a.logout=function(){s.remove("user"),o.$broadcast(n.logoutSuccess)},a.signup=function(e){var t=angular.copy(e);return t.name=JSON.stringify(e.name),new Promise(function(e,o){r.request("POST","/user",t).then(function(t){return s.put("user",{token:t.payload.token,user:t.payload.user}),e()},o)})},a.isAuthenticated=function(){return!!a.getUser()&&!!a.getUser()._id},a.isAuthorized=function(e){return angular.isArray(e)||(e=[e]),a.isAuthenticated()&&e.indexOf(a.getUser().role)!==-1},a}]);var app=angular.module("app");app.factory("JogFactory",["ApiFactory",function(e){var t={};return t.getJogs=function(t,r){return new Promise(function(o,n){var a="",s=void 0,i=void 0;t&&(s="fromDate="+t.toISOString()),r&&(i="toDate="+r.toISOString()),a=s&&i?"?"+s+"&"+i:"?"+(s||i),e.request("GET","/jog"+a).then(function(e){return o(e.payload)},n)})},t.createJog=function(t){return new Promise(function(r,o){e.request("POST","/jog",t).then(function(e){return r(e.payload)},o)})},t.updateJog=function(t){return new Promise(function(r,o){e.request("PUT","/jog/"+t._id,t).then(function(e){return r(e.payload)},o)})},t.deleteJog=function(t){return new Promise(function(r,o){e.request("DELETE","/jog/"+t).then(function(e){return r()},o)})},t}]);var app=angular.module("app");app.factory("UserFactory",["ApiFactory",function(e){var t={};return t.getUsers=function(){return new Promise(function(t,r){e.request("GET","/user").then(function(e){return t(e.payload)},r)})},t.updateUser=function(t){return t.name&&(t.name=JSON.stringify(t.name)),new Promise(function(r,o){e.request("PUT","/user/"+t._id,t).then(function(e){return r(e.payload)},o)})},t.deleteUser=function(t){return new Promise(function(r,o){e.request("DELETE","/user/"+t).then(function(e){return r()},o)})},t}]);var app=angular.module("app");app.controller("authController",["$scope","$rootScope","$state","AuthFactory","AUTH_EVENTS","HTTP_RESPONSES","$timeout",function(e,t,r,o,n,a,s){e.errorMessage="",e.getErrorMessage=function(){return e.errorMessage},e.credentials={name:{first:"",last:""},email:"",password:""},e.isLoginForm=function(){return"auth.login"===r.current.name},e.login=function(i){o.login(i).then(function(){t.$broadcast(n.loginSuccess),r.go("home.jogs")},function(r){t.$broadcast(n.loginFailed),s(function(){switch(r.status){case a.NotFound:e.errorMessage="Oops! That user doesn't exist.";break;case a.BadRequest:r.payload.InvalidArguments?(e.errorMessage="Some fields were invalid!",console.error("Invalid arguments:",r.payload.InvalidArguments)):"user already exists"===r.payload.message?e.errorMessage="An account already exists for that email.":e.errorMessage="Something went wrong. This is embarassing.";break;case a.Forbidden:e.errorMessage="Hmmm. Wrong password.";break;case a.InternalServerError:e.errorMessage="Something went wrong. This is embarassing."}})})},e.signup=function(i){o.signup(i).then(function(){t.$broadcast(n.signupSuccess),r.go("home.jogs")},function(r){t.$broadcast(n.signupFailed),s(function(){switch(r.status){case a.NotFound:e.errorMessage="Oops! That user doesn't exist.";break;case a.BadRequest:r.payload.InvalidArguments?(e.errorMessage="Some fields were invalid!",console.error("Invalid arguments:",r.payload.InvalidArguments)):"user already exists"===r.payload.message?e.errorMessage="An account already exists for that email.":e.errorMessage="Something went wrong. This is embarassing.";break;case a.Forbidden:e.errorMessage="Hmmm. Wrong password.";break;case a.InternalServerError:e.errorMessage="Something went wrong. This is embarassing."}})})}}]);var app=angular.module("app");app.controller("homeController",["$scope","$state","AuthFactory","USER_ROLES",function(e,t,r,o){e.navOpen=!0,e.isNavOpen=function(){return e.navOpen},e.toggleNavOpen=function(){e.navOpen=!e.navOpen},e.getState=function(){return t.current.name},e.getPageTitle=function(){switch(t.current.name){case"home.jogs":return"My Jogs";case"home.reports":return"Reports";case"home.manage-users":return"Manage Users";default:return""}},e.showMenuItem=function(e){var o=t.get(e);return r.isAuthorized(o.data.authorizedRoles)},e.getUser=function(){return r.getUser()},e.logout=function(){r.logout()}}]);var app=angular.module("app");app.controller("manageUsersController",["$scope","UserFactory","HTTP_RESPONSES","$timeout","$mdToast","AuthFactory","USER_ROLES",function(e,t,r,o,n,a,s){function i(e){n.show(n.simple().textContent(e).position("top right").action("ok").hideDelay(5e3))}e.users=[],e.getUsers=function(){return e.users},e.USER_ROLES=s,e.getRoleName=function(e){for(var t in s)if(s.hasOwnProperty(t)&&s[t]===e)return t;return""},e.editingId="",e.editEntry=function(t,r){e.editingId=t+r},e.stopEditing=function(){e.editingId=""},e.deleteUser=function(o){t.deleteUser(o._id).then(function(){i("Woohoo! The user was deleted."),e.fetchUsers()},function(e){switch(e.status){case r.Forbidden:a.logout();break;case r.NotFound:case r.BadRequest:case r.InternalServerError:i("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.updateUser=function(o){t.updateUser(o).then(function(){i("Woohoo! The user was updated."),e.fetchUsers()},function(e){switch(e.status){case r.BadRequest:i(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case r.Forbidden:a.logout();break;case r.InternalServerError:i("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.fetchUsers=function(){t.getUsers().then(function(t){o(function(){e.users=t||[]})},function(t){switch(t.status){case r.NotFound:o(function(){e.users=[]});break;case r.Forbidden:a.logout();break;case r.BadRequest:case r.InternalServerError:i("Something went wrong there. This is embarassing."),console.error("Response:",t);break;default:console.error("Unknown status code in response:",t)}})},e.fetchUsers()}]);var app=angular.module("app");app.controller("jogsController",["$scope","JogFactory","HTTP_RESPONSES","$timeout","$mdToast","AuthFactory",function(e,t,r,o,n,a){function s(e){n.show(n.simple().textContent(e).position("top right").action("ok").hideDelay(5e3))}var i=new Date;i.setDate(i.getDate()-7),e.date={from:i,to:new Date},e.jogs=[],e.getJogs=function(){return e.jogs},e.newJog={date:new Date,distance:0,time:0},e.computeAverageSpeed=function(e){var t=e.distance/(e.time/60);return isNaN(t)?"?":t.toFixed(2)},e.editingId="",e.editEntry=function(t,r){e.editingId=t+r},e.stopEditing=function(){e.editingId=""},e.createJog=function(o){t.createJog(o).then(function(){s("Woohoo! Your jog was added."),e.fetchJogs()},function(e){switch(e.status){case r.BadRequest:s(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case r.Forbidden:a.logout();break;case r.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.deleteJog=function(o){t.deleteJog(o._id).then(function(){s("Woohoo! Your jog was deleted."),e.fetchJogs()},function(e){switch(e.status){case r.Forbidden:a.logout();break;case r.NotFound:case r.BadRequest:case r.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.updateJog=function(o){t.updateJog(o).then(function(){s("Woohoo! Your jog was updated."),e.fetchJogs()},function(e){switch(e.status){case r.BadRequest:s(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case r.Forbidden:a.logout();break;case r.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.fetchJogs=function(){t.getJogs(e.date.from,e.date.to).then(function(t){o(function(){e.jogs=t||[]})},function(t){switch(t.status){case r.NotFound:o(function(){e.jogs=[]});break;case r.Forbidden:a.logout();break;case r.BadRequest:case r.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",t);break;default:console.error("Unknown status code in response:",t)}})},e.fetchJogs()}]);var app=angular.module("app");app.controller("reportsController",["$scope","$timeout","JogFactory","moment","HTTP_RESPONSES","$mdToast","AuthFactory",function(e,t,r,o,n,a,s){function i(e,t){if(!(e instanceof Date&&t instanceof Date))return[];e=o(e).startOf("day"),t=o(t).startOf("day");var r=o(e);if(t.diff(r,"days")<0)return[];for(var n=[];t.diff(r,"days")>=0;)n.push(r.startOf("day").toDate()),r.add(1,"days");return n}function u(e,t,r,n){var a=[];e=o(e).startOf("day"),t=o(t).startOf("day");var s=o(e);if(t.diff(s,"days")<0)return[];for(var i=[];t.diff(s,"days")>=0;)i.push(null),s.add(1,"days");for(var u=0;u<n.length;u++)a.push(i.slice());for(var c=0;c<r.length;c++)for(var d in n)a[d][o(r[c].date).startOf("day").diff(e,"days")]=r[c][n[d]];return a}function c(e){a.show(a.simple().textContent(e).position("top right").action("ok").hideDelay(5e3))}var d=new Date;d.setDate(d.getDate()-7),e.date={from:d,to:new Date};var l={scales:{xAxes:[{type:"time",unit:"day",unitStepSize:1,time:{unit:"day",displayFormats:{day:"MMM Do"}},scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{ticks:{beginAtZero:!0}}]}};e.charts={distance:{labels:[],data:[],series:["Distance"],options:function(){var e=JSON.parse(JSON.stringify(l));return e.scales.yAxes[0].scaleLabel={display:!0,labelString:"Distance (miles)"},e}()},speed:{labels:[],data:[],series:["Average Speed"],options:function(){var e=JSON.parse(JSON.stringify(l));return e.scales.yAxes[0].scaleLabel={display:!0,labelString:"Average Speed (mph)"},e}()}},e.fetchJogs=function(){var a=o(e.date.from).startOf("day").toDate(),d=o(e.date.to).endOf("day").toDate();r.getJogs(a,d).then(function(r){t(function(){var t=i(e.date.from,e.date.to);e.charts.distance.labels=t,e.charts.speed.labels=t;var o=u(e.date.from,e.date.to,r,["distance","time"]);e.charts.distance.data=[o[0]];for(var n=[],a=0;a<o[1].length;a++){var s=o[0][a]/(o[1][a]/60);n.push(s.toFixed(2))}e.charts.speed.data=[n]})},function(r){switch(r.status){case n.NotFound:t(function(){e.charts.distance.data=[],e.charts.speed.data=[]});break;case n.Forbidden:s.logout();break;case n.BadRequest:case n.InternalServerError:c("Something went wrong there. This is embarassing."),console.error("Response:",r);break;default:console.error("Unknown status code in response:",r)}})},e.fetchJogs()}]);