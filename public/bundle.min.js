"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},app=angular.module("app",["ui.router","angular-cache","ngMaterial","angularMoment"]);app.constant("HTTP_RESPONSES",{NoResponse:-1,OK:200,Created:201,MovedPermanently:301,BadRequest:400,Forbidden:403,NotFound:404,MethodNotAllowed:405,UnsupportedMediaType:415,TooManyRequests:429,InternalServerError:500,NotImplemented:501,ServiceUnavailable:503}),app.constant("USER_ROLES",{User:1,UserManager:2,Admin:3}),app.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",signupSuccess:"auth-signup-success",signupFailed:"auth-signup-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","USER_ROLES","$compileProvider","$mdDateLocaleProvider","$mdThemingProvider","moment","$httpProvider",function(e,t,o,n,r,a,s,i,u){function c(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;for(var t in e)if(e.hasOwnProperty(t)){var o=e[t];"string"!=typeof o||"[object Date]"!==Object.prototype.toString.call(new Date(o))||isNaN(new Date(o).getTime())?"object"===("undefined"==typeof o?"undefined":_typeof(o))&&c(o):e[t]=new Date(o)}}u.defaults.transformResponse.push(function(e){return c(e),e}),r.preAssignBindingsEnabled(!0),a.formatDate=function(e){return e?i(e).format("DD/MM/YYYY"):""},a.parseDate=function(e){var t=i(e,"DD/MM/YYYY",!0);return t.isValid()?t.toDate():new Date(NaN)},s.definePalette("customPalette",{50:"e4e7ea",100:"c0c6cd",200:"9aa4af",300:"707f8e",400:"526476",500:"34495e",600:"2f4255",700:"2a3b4c",800:"243342",900:"1b2631",A100:"C5CAE9",A200:"9FA8DA",A400:"7986CB",A700:"5C6BC0",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0});var d=s.extendPalette("green",{500:"#2ecc71",contrastDefaultColor:"light"});s.definePalette("customAccent",d),s.theme("default").primaryPalette("customPalette").accentPalette("customAccent",{default:"500"}),o.html5Mode(!0),t.otherwise("/jogs"),t.rule(function(e,t){var o=t.path(),n="/"===o[o.length-1];if(n){var r=o.substr(0,o.length-1);return r}}),e.state("auth",{abstract:!0,templateUrl:"/app/pages/auth/auth.view.html",controller:"authController"}).state("auth.login",{url:"/login"}).state("auth.signup",{url:"/signup"}).state("home",{abstract:!0,templateUrl:"/app/pages/home/home.view.html",controller:"homeController"}).state("home.jogs",{url:"/jogs",templateUrl:"/app/pages/home/jogs/jogs.view.html",controller:"jogsController",data:{authorizedRoles:[n.User,n.UserManager,n.Admin]}}).state("home.reports",{url:"/reports",data:{authorizedRoles:[n.User,n.UserManager,n.Admin]}}).state("home.manage-users",{url:"/manage-users",data:{authorizedRoles:[n.UserManager,n.Admin]}})}]),app.run(["$rootScope","$state","AuthFactory","AUTH_EVENTS",function(e,t,o,n){e.$on("$stateChangeStart",function(t,r){r.data&&r.data.authorizedRoles&&(o.isAuthorized(r.data.authorizedRoles)||(t.preventDefault(),o.isAuthenticated()?e.$broadcast(n.notAuthorized):e.$broadcast(n.notAuthenticated)))}),e.$on(n.notAuthenticated,function(){t.go("auth.login")})}]),app.controller("rootController",["$scope","$state",function(e,t){e.app_test="APP WORKING"}]),angular.module("app").constant("API_URL","https://project-jogging-tracker.herokuapp.com/api");var app=angular.module("app");app.factory("ApiFactory",["$http","CacheFactory","API_URL","HTTP_RESPONSES",function(e,t,o,n){function r(e,t){var o=[];for(var n in e)o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return o.join("&")}var a={};return a.request=function(a,s,i){return new Promise(function(u,c){if(["POST","GET","PUT","DELETE"].indexOf(a)===-1)throw new Error("received unsupported HTTP method");if("string"!=typeof s)throw new Error("endpoint must be a string");"/"!==s[0]&&(s="/"+s);var d={method:a,url:o+s,headers:{}};if("POST"!==a&&"PUT"!==a||(d.headers["Content-Type"]="application/x-www-form-urlencoded",d.transformRequest=r),t.get("authCache")){var l=t.get("authCache"),p=l.get("user");p&&(l.info("user").isExpired||(d.headers.Authorization=p.token))}i&&("POST"!==a&&"PUT"!==a||(d.data=i),"GET"===a&&(d.params=i)),e(d).then(function(e){return u({status:e.status,payload:e.data.payload})},function(e){return c(e?{status:e.status,payload:e.data.payload}:{status:n.NoResponse,payload:null})})})},a}]);var app=angular.module("app");app.factory("AuthFactory",["$http","CacheFactory","ApiFactory",function(e,t,o){var n={},r=void 0;return r=t.get("authCache")?t.get("authCache"):t("authCache",{storageMode:"localStorage",maxAge:432e5,deleteOnExpire:"aggressive",recycleFreq:6e4}),n.getUser=function(){var e=r.get("user");return e?r.info("user").isExpired?null:e.user:null},n.login=function(e){return new Promise(function(t,n){o.request("POST","/user/authenticate",e).then(function(e){return r.put("user",{token:e.payload.token,user:e.payload.user}),t()},n)})},n.signup=function(e){var t=angular.copy(e);return t.name=JSON.stringify(e.name),new Promise(function(e,n){o.request("POST","/user",t).then(function(t){return r.put("user",{token:t.payload.token,user:t.payload.user}),e()},n)})},n.isAuthenticated=function(){return!!n.getUser()&&!!n.getUser()._id},n.isAuthorized=function(e){return angular.isArray(e)||(e=[e]),n.isAuthenticated()&&e.indexOf(n.getUser().role)!==-1},n}]);var app=angular.module("app");app.factory("JogFactory",["ApiFactory",function(e){var t={};return t.getJogs=function(){return new Promise(function(t,o){e.request("GET","/jog").then(function(e){return t(e.payload)},o)})},t.createJog=function(t){return new Promise(function(o,n){e.request("POST","/jog",t).then(function(e){return o(e.payload)},n)})},t.updateJog=function(t){return new Promise(function(o,n){e.request("PUT","/jog/"+t._id,t).then(function(e){return o(e.payload)},n)})},t.deleteJog=function(t){return new Promise(function(o,n){e.request("DELETE","/jog/"+t).then(function(e){return o()},n)})},t}]);var app=angular.module("app");app.controller("authController",["$scope","$rootScope","$state","AuthFactory","AUTH_EVENTS","HTTP_RESPONSES","$timeout",function(e,t,o,n,r,a,s){e.errorMessage="",e.getErrorMessage=function(){return e.errorMessage},e.credentials={name:{first:"",last:""},email:"",password:""},e.isLoginForm=function(){return"auth.login"===o.current.name},e.login=function(i){n.login(i).then(function(){t.$broadcast(r.loginSuccess),o.go("home.jogs")},function(o){t.$broadcast(r.loginFailed),s(function(){switch(o.status){case a.NotFound:e.errorMessage="Oops! That user doesn't exist.";break;case a.BadRequest:o.payload.InvalidArguments?(e.errorMessage="Some fields were invalid!",console.error("Invalid arguments:",o.payload.InvalidArguments)):"user already exists"===o.payload.message?e.errorMessage="An account already exists for that email.":e.errorMessage="Something went wrong. This is embarassing.";break;case a.Forbidden:e.errorMessage="Hmmm. Wrong password.";break;case a.InternalServerError:e.errorMessage="Something went wrong. This is embarassing."}})})},e.signup=function(i){n.signup(i).then(function(){t.$broadcast(r.signupSuccess),o.go("home.jogs")},function(o){t.$broadcast(r.signupFailed),s(function(){switch(o.status){case a.NotFound:e.errorMessage="Oops! That user doesn't exist.";break;case a.BadRequest:o.payload.InvalidArguments?(e.errorMessage="Some fields were invalid!",console.error("Invalid arguments:",o.payload.InvalidArguments)):"user already exists"===o.payload.message?e.errorMessage="An account already exists for that email.":e.errorMessage="Something went wrong. This is embarassing.";break;case a.Forbidden:e.errorMessage="Hmmm. Wrong password.";break;case a.InternalServerError:e.errorMessage="Something went wrong. This is embarassing."}})})}}]);var app=angular.module("app");app.controller("homeController",["$scope","$state","AuthFactory","USER_ROLES",function(e,t,o,n){e.navOpen=!1,e.isNavOpen=function(){return e.navOpen},e.toggleNavOpen=function(){e.navOpen=!e.navOpen},e.getState=function(){return t.current.name},e.getPageTitle=function(){switch(t.current.name){case"home.jogs":return"My Jogs";case"home.reports":return"Reports";case"home.manage-users":return"Manage Users";default:return""}},e.showMenuItem=function(e){var n=t.get(e);return o.isAuthorized(n.data.authorizedRoles)}}]);var app=angular.module("app");app.controller("jogsController",["$scope","JogFactory","HTTP_RESPONSES","$timeout","$mdToast",function(e,t,o,n,r){function a(){t.getJogs().then(function(t){n(function(){e.jogs=t||[]})},function(t){switch(t.status){case o.NotFound:n(function(){e.jogs=[]});break;case o.Forbidden:break;case o.BadRequest:case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",t);break;default:console.error("Unknown status code in response:",t)}})}function s(e){r.show(r.simple().textContent(e).position("top right").action("ok").hideDelay(5e3))}var i=new Date;i.setDate(i.getDate()-7),e.date={from:i,to:new Date},e.jogs=[],e.getJogs=function(){return e.jogs},e.newJog={date:new Date,distance:0,time:0},e.computeAverageSpeed=function(e){var t=e.distance/e.time;return isNaN(t)?"?":t.toFixed(2)},e.editingId="",e.editEntry=function(t,o){e.editingId=t+o},e.stopEditing=function(){e.editingId=""},e.createJog=function(e){t.createJog(e).then(function(){s("Woohoo! Your jog was added."),a()},function(e){switch(e.status){case o.BadRequest:s(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case o.Forbidden:break;case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.deleteJog=function(e){t.deleteJog(e._id).then(function(){s("Woohoo! Your jog was deleted."),a()},function(e){switch(e.status){case o.Forbidden:break;case o.NotFound:case o.BadRequest:case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},e.updateJog=function(e){t.updateJog(e).then(function(){s("Woohoo! Your jog was updated."),a()},function(e){switch(e.status){case o.BadRequest:s(e.payload.InvalidArguments&&e.payload.InvalidArguments.length>0?"Invalid "+e.payload.InvalidArguments[0]+" parameter!":"Some of the parameters you provided are invalid.");break;case o.Forbidden:break;case o.InternalServerError:s("Something went wrong there. This is embarassing."),console.error("Response:",e);break;default:console.error("Unknown status code in response:",e)}})},a()}]);